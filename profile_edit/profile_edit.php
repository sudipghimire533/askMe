<?php ini_set('display_errors',1);ini_set('display_startup_errors',1);error_reporting(E_ALL);if(!session_id()){session_start();}require_once('../server/global.php');if(!getLoginStatus()){echo "<a href='/login'>sign in to get your profile page...</a>";exit;}$thisUserId=$_SESSION['userId'];$conn=get_connection();$res=$conn->query("SELECT user.FirstName as firstName, user.LastName as lastName, user.UserName as userName, user.Intro as intro, user.PictureReal as picture, GROUP_CONCAT(tg.Name) as tags FROM User user LEFT JOIN UserTag ut ON ut.User=user.Id LEFT JOIN Tags tg ON tg.Id =ut.TagWHERE user.Id=$thisUserId;")or die($conn->error." in line ".__LINE__);$res=$res->fetch_all(MYSQLI_ASSOC)[0];$FirstName=$res['firstName'];$LastName=$res['lastName'];$UserName=$res['userName'];$Intro=$res['intro'];$Tags=explode(',',$res['tags']);$picture=$res['picture']; ?><!doctypehtml><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>Edit your profile....</title><link href="/global/global.css"rel="stylesheet"type="text/css"><link href="/global/fonts/all.css"rel="stylesheet"type="text/css"><script src="/global/global.js"type="text/javascript"></script><link href="/profile_edit/profile_edit.css"rel="stylesheet"type="text/css"></head><body onload="Ready()"><?php include('../global/navbar.php'); ?><div id="Main"><div id="ProfileEditor"><div class="editBlock"id="editProfileImage"><div class="label">You Profile Picture</div><img alt="Sudip Ghimire"class="value profile_img"src="<?php echo $picture  ?>"title="Your Profile pcture..."> <i class="edit_icon fa-pen"onclick="toggleEdit(this)"title="Change your Proifle picture..."></i><div class="editor"><p>Your profile picture will be same from your facebook</p></div></div><div class="editBlock"id="editTags"><div class="label">You Tags</div><div class="value"><?php foreach($Tags as $tag){echo"<span class='tag'>$tag</span>";} ?></div><i class="edit_icon fa-pen"onclick="editTags(this,!1)"title="Edit your faviourate Tags"></i><div class="editor"><i class="addtag_icon fa-plus"onclick="toggleAddTag(this)"></i> <span class="addedTags"><?php foreach($Tags as $tag){echo"<span class='tag' onclick='this.remove()'>$tag</span>";} ?></span><input id="Tags"value=""name="Tags"style="display:none"> <i class="fa-save save_icon"onclick="editTags(this,!0)"title="Save my Tags..">save</i><div class="availableTags"><input id="searchAvailableTags"placeholder="Filter Tags.."onkeyup="filterTag(this.value)"><br></div></div></div><div class="editBlock"id="editName"><div class="label">You Name</div><div class="value"><?php echo $FirstName." ".$LastName; ?></div><i class="edit_icon fa-pen"onclick="editName(this,!1)"title="Edit Your Name"></i><div class="editor"><input id="Name"placeholder="Your Name"value="<?php echo $FirstName." ".$LastName; ?>"> <i class="fa-save save_icon"onclick="editName(this,!0)"title="Save My Name">save</i></div></div><div class="editBlock"id="editUserName"><div class="label">You UserName</div><div class="value"><?php echo $UserName; ?></div><i class="edit_icon fa-pen"onclick="editName(this,!1)"title="Edit Your Username"></i><div class="editor"><input id="UserName"placeholder="New Username"value="<?php echo $UserName; ?>"name="UserName"> <i class="fa-save save_icon"onclick="editUserName(this,!0)"title="Save this Username">save</i></div></div><div class="editBlock"id="editIntro"><div class="label">You Intro</div><div class="value"><?php echo $Intro  ?></div><i class="edit_icon fa-pen"onclick="editIntro(this,!1)"title="Edit your Intro Text"></i><div class="editor"><input id="Intro"placeholder="You short Intro.."value="<?php echo $Intro; ?>"name="Intro"> <i class="fa-save save_icon"onclick="editIntro(this,!0)"title="Save Your Intro Text..">save</i></div></div></div><div class="notifyCenter"><div class="notify"style="display:none"></div></div></div></body><script>var allTags=new String;let addedTagsShow,availableTagShow,ntg;function Ready(){notification=document.getElementsByClassName("notify")[0],addedTagsShow=document.getElementsByClassName("addedTags")[0],availableTagShow=document.getElementsByClassName("availableTags")[0];let e,t=document.createElement("span");t.classList.add("tag"),t.setAttribute("onclick","addTag(this)"),allTags.split(",").forEach(function(a){(e=t.cloneNode(!0)).textContent=a.trim(),availableTagShow.appendChild(e)})}function addTag(e){let t=e.cloneNode(!0);t.setAttribute("onclick","removeTag(this)"),addedTagsShow.appendChild(t),e.classList.add("added")}function removeTag(e){(ntg=e.cloneNode(!0)).setAttribute("onclick","addTag(this)"),ntg.classList.remove("added"),availableTagShow.appendChild(ntg),e.remove()}function toggleAddTag(e){e.classList.toggle("fa-times"),e.classList.toggle("fa-plus"),document.getElementsByClassName("availableTags")[0].classList.toggle("active")}function filterTag(e){e=e.trim();let t=document.getElementsByClassName("availableTags")[0].getElementsByClassName("tag");if(0!=e.length)for(let a=0;a<t.length;a++)-1===t[a].textContent.indexOf(e)?t[a].classList.add("inactive"):t[a].classList.remove("inactive");else for(let e=0;e<t.length;e++)t[e].classList.remove("inactive")}function toggleEdit(e){let t=e.parentElement;for(;!t.classList.contains("editBlock");)t=t.parentElement;t.classList.toggle("active"),lastEdit=t,(e=t.getElementsByClassName("edit_icon")[0]).classList.toggle("fa-pen"),e.classList.toggle("fa-times"),e.setAttribute("title","Cancel")}function editName(e,t=!1){if(!0===t){let e=document.getElementById("Name"),t=e.value.trim();if(t=t.replace("  "," "),e.value=t,t.indexOf(" ")!=t.lastIndexOf(" "))return void notify("Only one space is allowed...",1);if(t.length<4)return void notify("Too short name...",1);sendData("UpdateName",t,function(){document.getElementById("editName").getElementsByClassName("value")[0].textContent=t,notify("Nice Name!!"+t)})}toggleEdit(e)}function editIntro(e,t=!1){if(!0===t){let e=document.getElementById("Intro").value.trim();sendData("UpdateIntro",decodeURI(e),function(){document.getElementById("editIntro").getElementsByClassName("value")[0].textContent=e,notify("You intro has been updated!!!")})}toggleEdit(e)}function editUserName(e,t=!1){if(!0===t){let e=document.getElementById("UserName").value.trim();e.replace(/[^A-Za-z0-9_]/),"",sendData("UpdateUserName",e,function(){document.getElementById("editUserName").getElementsByClassName("value")[0].textContent=e,notify("UserName changed...")},function(e){notify("An error occured. Try another username...",2)})}toggleEdit(e)}function editTags(e,t=!1){if(!0===t){let e=new Map,t=document.getElementsByClassName("addedTags")[0].getElementsByClassName("tag"),a=new Array,n=document.getElementById("Tags");n.value="";for(let s=0;s<t.length;++s)e.has(t[s].textContent)||(e.set(t[s].textContent,!0),n.value+=t[s].textContent+",",a.push(t[s]));if(n.value=n.value.substr(0,n.value.length-1),0==a.length)return void notify("You should at least provide one tag",2);sendData("UpdateTags",n.value,function(){let e=document.getElementById("editTags").getElementsByClassName("value")[0];e.innerHTML="";for(let t=0;t<a.length;++t)e.appendChild(a[t].cloneNode(!0));notify("Your Tags has been updated sucessfully...")})}toggleEdit(e)}function sendData(e,t,a=function(){},n=null){let s=new XMLHttpRequest;s.onerror=function(){notify("Error while sending Request...",2)},s.onreadystatechange=function(){4==this.readyState&&200==this.status&&(0==this.responseText||"0"==this.responseText?a():null==n?(notify("Server returned an error...",2),console.log(this.responseText)):n(this.textContent))},s.open("POST","/server/quick_action.php",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send("param="+e+"&data="+encodeURIComponent(t)),console.log("param="+e+"&data="+t)}</script><?php $allTags=$conn->query("SELECT GROUP_CONCAT(Name) FROM  Tags;")or die('There was an error...');$allTags=$allTags->fetch_array(MYSQLI_NUM)[0];echo "<script type='text/javascript'>allTags=".json_encode($allTags)."</script>";$conn->close(); ?></html>